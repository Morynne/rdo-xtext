<html>
<head>
<link rel="stylesheet" type="text/css" href="../styles/rao_general.css">
<link rel="stylesheet" href="../styles/rao_highlight.css">
<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
<script src="../scripts/thirdparty/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="../scripts/thirdparty/jquery-2.1.4.min.js"></script>
<script src="../scripts/table_of_contents.js"></script>
</head>
<body>
<h2>Ресурсы</h2>
<h3>Объявление типа ресурса</h3>
<p>Объявление типа ресурса производится указанием ключевого слова <code class="rao">type</code>.</p>
<pre><code class="rao">type <i>имя_типа</i> {
    <i>список_параметров</i>
}</code></pre>
<p>Тело типа ресурса представляет собой список произвольного числа параметров (но не менее одного), заключенный в фигурные скобки. Параметры разделяются точками с запятой.</p>
<pre><code class="rao"><i>имя_типа</i> <i>имя_параметра</i> [= <i>значение_по_умолчанию</i>];</code></pre>
<p>Параметр ресурса может иметь один из стандартных типов данных языка.</p>
<pre><code class="rao">enum Состояние_станка {свободен, загружается, готов_к_обработке, работает,
разгружается, закончил_обработку, требует_переналадки, требует_ремонта}

type Станок {
    int номер;
    Состояние_станка состояние;
    double длительность_обработки;
}</code></pre>
<h3>Создание ресурса</h3>
<p>Для создания ресурса вызывается статический метод <code class="rao">create()</code> у типа ресурса. В данном случае тип ресурса выступает в роли фабрики. В метод <code class="rao">create()</code> передается список значений параметров ресурса, которыми ресурс будет проинициализирован при создании.</p>
<pre><code class="rao"><i>имя_типа</i>.create(<i>список_параметров</i>);</code></pre>
<p>Примеры:</p>
<pre><code class="rao">Станок.create(0, Состояние_станка.свободен, 30);
Станок.create(1, Состояние_станка.свободен, 35);
Станок.create(2, Состояние_станка.свободен, 20);</code></pre>
<p>В описанной выше конструкции ресурс создается без имени. Для создания ресурса, к параметрам которого можно будет обращаться в модели по имени, в левой части конструкции указывается ключевое слово <code class="rao">resource</code> и имя ресурса, а в правой - конструкция создания ресурса.</p>
<pre><code class="rao">resource <i>имя_ресурса</i> = <i>имя_типа</i>.create(<i>список_параметров</i>);</code></pre>
<p>В случае, если ресурс создается в модели глобально и имеет имя, к этому параметрам этого ресурса можно обратиться по имени в любом месте модели. Если ресурс создается с именем в теле образца или события, это имя имеет смысл только локально, и при обращении к ресурсу из других частей модели требуется пользоваться механизмом релевантных ресурсов.</p>
<pre><code class="rao">цех_1 = Цех.create(1, 0); // имя ресурса определено глобально

event поступление_заготовки() {
    resource заготовка = Заготовка.create(Тип_детали.next(), *, *); // имя ресурса определено локально
    заготовка.приоритет = 0; // обращение к ресурсу по локальному имени
    цех_1.число_поступивших_заготовок++; // обращение к ресурсу по глобальному имени
}</code></pre>
<p>В случае, если при описании типа было указано значение по умолчанию, вместо значения параметра можно указать символ <code class="rao">*</code>. В этом случае начальное значение параметра будет равно значению по умолчанию.</p>
<pre><code class="rao">type Станок {
    int номер;
    Состояние состояние = Состояние.свободен;
    double длительность_обработки;
}

resource станок_1 = Станок.create(0, *, 30);</code></pre>
<h3>Удаление ресурса</h3>
<p>Для удаления ресурса у него вызывается метод <code class="rao">erase()</code>. Удалены могут быть ресурсы, подобранные в образце как релевантные, либо ресурсы с локальными именами (но только до тех пор, пока их имя не вышло из области видимости). Удалять ресурсы при обращении по глобальному имени запрещено.</p>
<pre><code class="rao">rule вывоз_обработанных_заготовок() {
    relevant заготовка = Заготовка.select(заготовка.состояние == Состояние_заготовки.Обработана);
    set execute() {
        заготовка.erase();
    }
}</code></pre>
</body>
</html>
